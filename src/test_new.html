<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Exercise 1</title>

        <!-- Blockly deps -->
        <!--<<script src="js/blockly/blockly_compressed.js"></script>
        <script src="js/blockly/blocks_compressed.js"></script>-->
        <!--<script src="js/blocks.js"></script>
  
        <script src="js/blockly/msg/js/en.js"></script>-->

        <script type="text/javascript" src="js/edx_state.js"></script>
        <!--<script type="text/javascript" src="js/three/three.js"></script>-->
        <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r66/three.min.js"></script>-->
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/bootstrap-theme.min.css">
        <link type="text/css" rel="stylesheet" href="css/graph.css">
        <link type="text/css" rel="stylesheet" href="css/detail.css">
        <link type="text/css" rel="stylesheet" href="css/legend.css">


        
        <!--
            TODO: this causes a bug in the ace editor, namely the "div, span, p, td " style def
            <link type="text/css" rel="stylesheet" href="css/lines.css">
            <link type="text/css" rel="stylesheet" href="css/extensions.css">
        -->
        <script type="text/javascript" data-main="js/app" src="js/require.js"></script>

        <style type="text/css" media="screen">
            body {
            }
            #editor {
                width: 100%;
                height: 400px;
                border: 1px solid #333;
                border-radius: 5px;
            }
            #viewport {
                width: 100%;
                height: 400px;
                border: 1px solid #333;
                border-radius: 5px;
                position: relative;
            }
            #overlay {
                background: rgba(0, 0, 0, 0.0);
                position: absolute;
                top: 0px;
                right: 10px;
                cursor: default;
            }
            #control {
                background: rgba(0, 0, 0, 0.0);
                position: absolute;
                bottom: 5px;
                right: 5px;
            }
            #grapher {
                width: 100%;
                height: 400px;
                border: 1px solid #333;
                border-radius: 5px;
            }
                #chart {
                    position: relative;
                    left: 40px;
                }
                #legend {
                    position: absolute;
                    top: 0px;
                    left: 0px;
                }
                #y_axis {
                    position: absolute;
                    top: 0;
                    bottom: 0;
                    width: 40px;
                }
            #log-view {
                width: 100%;
                height: 400px;
                overflow: scroll;
            }
        </style>
    </head>
    <body>

        <xml id="toolbox" style="display: none">

        <category name="Commands">
          <block type="drone_move">
            <value name="VALUE">
              <block type="math_number">
                <field name="NUM">10</field>
              </block>
            </value>
          </block>
          <block type="drone_turn">
            <value name="VALUE">
              <block type="math_number">
                <field name="NUM">10</field>
              </block>
            </value>
          </block>
        </category>


    <!--     <category name="Logic">
          <block type="controls_if"></block>
          <block type="logic_compare"></block>
          <block type="logic_operation"></block>
          <block type="logic_negate"></block>
          <block type="logic_boolean"></block>
        </category> -->
    <!--     <category name="Loops">
          <block type="controls_repeat_ext">
            <value name="TIMES">
              <block type="math_number">
                <field name="NUM">10</field>
              </block>
            </value>
          </block>
          <block type="controls_whileUntil"></block>
        </category> -->
        <category name="Math">
          <block type="math_number"></block>
          <block type="math_arithmetic"></block>
          <block type="math_single"></block>
        </category>
        <category name="Text">
          <block type="text"></block>
          <block type="text_length"></block>
          <block type="text_print"></block>
        </category>
      </xml>

      <xml id="startBlocks" style="display: none">
    
          <block type="drone_move" x="272" y="53">
                  <field name="DIR">right</field>
                  <value name="VALUE">
                    <block type="math_number">
                      <field name="NUM">1</field>
                    </block>
                  </value>
                  <next>
                    <block type="drone_turn">
                      <field name="DIR">turn_left</field>
                      <value name="VALUE">
                        <block type="math_number">
                          <field name="NUM">45</field>
                        </block>
                      </value>
                      <next>
                        <block type="drone_move">
                          <field name="DIR">forward</field>
                          <value name="VALUE">
                            <block type="math_number">
                              <field name="NUM">1.4</field>
                            </block>
                          </value>
                          <next>
                            <block type="drone_turn">
                              <field name="DIR">turn_right</field>
                              <value name="VALUE">
                                <block type="math_number">
                                  <field name="NUM">1</field>
                                </block>
                              </value>
                              <next>
                                <block type="drone_move">
                                  <field name="DIR">right</field>
                                  <value name="VALUE">
                                    <block type="math_number">
                                      <field name="NUM">1</field>
                                    </block>
                                  </value>
                                  <next>
                                    <block type="drone_turn">
                                      <field name="DIR">turn_left</field>
                                      <value name="VALUE">
                                        <block type="math_number">
                                          <field name="NUM">45</field>
                                        </block>
                                      </value>
                                      <next>
                                        <block type="drone_move">
                                          <field name="DIR">forward</field>
                                          <value name="VALUE">
                                            <block type="math_number">
                                              <field name="NUM">0.7</field>
                                            </block>
                                          </value>
                                          <next>
                                            <block type="drone_turn">
                                              <field name="DIR">turn_right</field>
                                              <value name="VALUE">
                                                <block type="math_number">
                                                  <field name="NUM">90</field>
                                                </block>
                                              </value>
                                              <next>
                                                <block type="drone_move">
                                                  <field name="DIR">forward</field>
                                                  <value name="VALUE">
                                                    <block type="math_number">
                                                      <field name="NUM">0.7</field>
                                                    </block>
                                                  </value>
                                                  <next>
                                                    <block type="drone_turn">
                                                      <field name="DIR">turn_left</field>
                                                      <value name="VALUE">
                                                        <block type="math_number">
                                                          <field name="NUM">45</field>
                                                        </block>
                                                      </value>
                                                      <next>
                                                        <block type="drone_move">
                                                          <field name="DIR">forward</field>
                                                          <value name="VALUE">
                                                            <block type="math_number">
                                                              <field name="NUM">1</field>
                                                            </block>
                                                          </value>
                                                          <next>
                                                            <block type="drone_turn">
                                                              <field name="DIR">turn_right</field>
                                                              <value name="VALUE">
                                                                <block type="math_number">
                                                                  <field name="NUM">45</field>
                                                                </block>
                                                              </value>
                                                              <next>
                                                                <block type="drone_move">
                                                                  <field name="DIR">backward</field>
                                                                  <value name="VALUE">
                                                                    <block type="math_number">
                                                                      <field name="NUM">1.4</field>
                                                                    </block>
                                                                  </value>
                                                                  <next>
                                                                    <block type="drone_turn">
                                                                      <field name="DIR">turn_left</field>
                                                                      <value name="VALUE">
                                                                        <block type="math_number">
                                                                          <field name="NUM">45</field>
                                                                        </block>
                                                                      </value>
                                                                      <next>
                                                                        <block type="drone_move">
                                                                          <field name="DIR">forward</field>
                                                                          <value name="VALUE">
                                                                            <block type="math_number">
                                                                              <field name="NUM">1</field>
                                                                            </block>
                                                                          </value>
                                                                        </block>
                                                                      </next>
                                                                    </block>
                                                                  </next>
                                                                </block>
                                                              </next>
                                                            </block>
                                                          </next>
                                                        </block>
                                                      </next>
                                                    </block>
                                                  </next>
                                                </block>
                                              </next>
                                            </block>
                                          </next>
                                        </block>
                                      </next>
                                    </block>
                                  </next>
                                </block>
                              </next>
                            </block>
                          </next>
                        </block>
                      </next>
                    </block>
                  </next>
                </block>
  </xml>




        <div class="container">
            <div class="row">
                <div class="col-sm-11">
                    <div id="viewport">
                        <div id="overlay">some text overlay</div>
                        <div id="control">
                            <div class="btn-group">
                                <button id="run-simulation" type="button" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-play"></span></button>
                                <!--button type="button" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-pause"></button-->
                                <button id="stop-simulation" type="button" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-stop"></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-11">
                    <div id="blockly-workspace" style="height: 480px; width: 1024;">
                       


                        <!-- <iframe src="generator.html" width="640" height="900"></iframe> -->

                    </div>
                </div>
                <div class="col-sm-1">
                    <button id="run" type="button" class="btn btn-primary">Run</button>
                    <button onclick="showCode()" class="btn btn-primary">Show Python</button>
                    <button onclick="showDom()" class="btn btn-primary">Show Dom</button>
                    <button onclick="runCode()" class="btn btn-primary">Run Python</button>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-11">
                    <div id="grapher" class="aGraph" style="position: relative">
                        <div id="legend"></div>
                        <div id="chart"></div>
                        <div id="y_axis"></div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-11">
                    <div id="editor"></div>
                </div>
                <div class="col-sm-1">
                    <button id="run" type="button" class="btn btn-primary">Run</button>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-11">
                    <pre id="log-view">
                    </pre>
                </div>
            </div>
        </div>



        <script>

            function setup() {
                var workspace = Blockly.inject('blockly-workspace',
                      {media: 'assets/generator/',
                       toolbox: document.getElementById('toolbox')});
                  Blockly.Xml.domToWorkspace(document.getElementById('startBlocks'),
                                             workspace);

                  function showCode() {
                    // Generate Python code and display it.
                    Blockly.Python.INFINITE_LOOP_TRAP = null;
                    var code = Blockly.Python.workspaceToCode(workspace);
                    alert(code);
                  }

                  function showDom() {
                    // Generate Python code and display it.
                    Blockly.Python.INFINITE_LOOP_TRAP = null;
                    var xmlDom = Blockly.Xml.workspaceToDom(workspace);
                    var xmlText = Blockly.Xml.domToPrettyText(xmlDom);
                    alert(xmlText);
                  }
                  //foo is now loaded.
            }
            function run_setup () {

              require(['blockly/blockly_compressed','blockly/blocks_compressed','blocks'], function (foo){

                    setup();


                
                });
            }

            run_setup();
            
    
          

            // function runCode() {
            //   // Generate Python code and run it.
            //   window.LoopTrap = 1000;
            //   Blockly.Python.INFINITE_LOOP_TRAP =
            //       'if (--window.LoopTrap == 0) throw "Infinite loop.";\n';
            //   var code = Blockly.Python.workspaceToCode(workspace);
            //   Blockly.Python.INFINITE_LOOP_TRAP = null;
            //   try {
            //     eval(code);
            //   } catch (e) {
            //     alert(e);
            //   }
            // }
      </script>


    </body>
</html>
